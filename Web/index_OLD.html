<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- SEO & Open Data Meta -->
<meta name="author" content="Hunter Inman (KK7NQN)" />
<meta name="keywords" content="Ham Radio, KK7NQN, Repeater, QSO Logs, AllStarLink, Whisper AI, Call Sign Activity, HamNet, Open Data, GNU GPL" />
<meta name="license" content="GNU General Public License v3.0" />
<meta name="robots" content="index, follow" />

<!-- Open Graph Meta for Social Bots -->
<meta property="og:site_name" content="KK7NQN Repeater Project" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://kk7nqn.net/logo.png" />

  
  <title>Repeater Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #0d1117; color: #c9d1d9; }
    .card { background-color: #161b22; border: 1px solid #30363d; }
    .table { color: #c9d1d9; }
    h1, h2 { color: #58a6ff; }
  </style>
  
  
  
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": ["Dataset", "WebAPI"],
  "name": "KK7NQN Repeater Dashboard & QSO Dataset",
  "description": "A live-updating dataset of ham radio QSOs, transcriptions, and call sign metadata from AllStarLink-linked nets. Includes open access Web API for developers and researchers.",
  "url": "https://kk7nqn.net",
  "license": "https://kk7nqn.net/license.html",
  "isAccessibleForFree": true,
  "keywords": ["ham radio", "repeater", "AllStarLink", "QSO", "transcripts", "callsign", "amateur radio", "net logging", "live API", "open data"],
  "creator": {
    "@type": "Person",
    "name": "KK7NQN",
    "url": "https://kk7nqn.net/about.html"
  },
  "distribution": {
    "@type": "DataDownload",
    "encodingFormat": "application/json",
    "contentUrl": "https://kk7nqn.net/api/"
  },
  "documentation": "https://kk7nqn.net/how_to.html",
  "provider": {
    "@type": "Organization",
    "name": "KK7NQN",
    "url": "https://kk7nqn.net"
  },
  "dateModified": "2025-08-04"
}
</script>

  
  
</head>
<body>
  <div class="container mt-4">
    <h1 class="text-center">📡 KK7NQN-R Repeater System Dashboard</h1>
	<ul class="nav nav-tabs justify-content-center mb-4">
  <li class="nav-item">
    <a class="nav-link active bg-dark text-white" href="index.html">Dashboard</a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="netcontrol.html">Net Control</a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="/nets/info.html">Nets</a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="schedule.html">Schedule</a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="about.html">About</a>
  </li>
  <li class="nav-item">
        <a class="nav-link text-white" href="how_to.html">How To</a>
  </li>
</ul>

		<p class="text-center">Ouput: 145.1250 Input: 223.240 Tone: 110.9 Located North East of Shelton WA</p>
		<p class="text-center"><a href="https://stats.allstarlink.org/stats/62222/networkMap">AllStar: 62222</a></p>
    <!-- Callsign Stats -->
    <div class="row mt-4">
      <div class="col-md-6">
        <div class="card p-3">
          <h2>Top Callsigns</h2>
          <table class="table table-sm table-striped">
            <thead>
              <tr><th>Callsign</th><th>Seen Count</th><th>Last Seen</th></tr>
            </thead>
            <tbody id="callsignTableBody"></tbody>
          </table>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card p-3">
          <h2>Live Server Stats</h2>
          <canvas id="systemStatsChart" height="200"></canvas>
        </div>
		<div class="card p-3">
          <h2>Live Repeater Stats</h2>
          <canvas id="repeaterStatsChart" height="200"></canvas>
        </div>
      </div>
    </div>

    <!-- Individual Temperature Charts -->
    <div class="row mt-4" id="temperatureCharts"></div>
	<div class="card p-3">
            <h2>Temperatures</h2>
            <canvas id="tempsChart" height="200"></canvas>
         </div>

<!--
		<div class="card p-3">
            <h2>Intake Temp</h2>
            <canvas id="intakeChart" height="200"></canvas>
         </div>
		 <div class="card p-3">
            <h2>Amplifier Temp</h2>
            <canvas id="amplifierChart" height="200"></canvas>
         </div>
		 <div class="card p-3">
            <h2>Radio Temp</h2>
            <canvas id="radioChart" height="200"></canvas>
         </div>
		 <div class="card p-3">
            <h2>Internal Temp</h2>
            <canvas id="internalChart" height="200"></canvas>
         </div>
	-->
    <!-- Transcriptions Log -->
    <div class="row mt-4">
      <div class="col">
        <div class="card p-3">
          <h2>Transcription Log</h2>
          <table class="table table-sm table-hover">
            <thead>
              <tr><th>Timestamp</th><th>Callsign</th><th>Transcript</th></tr>
            </thead>
            <tbody id="transcriptTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
<div class="row mt-4">
  <div class="col">
    <input type="text" id="callsignSearch" class="form-control mb-3" placeholder="Search callsigns...">
  </div>
</div>
    <!-- All Callsigns List -->
    <div class="row mt-4">
      <div class="col">
        <div class="card p-3">
          <h2>All Known Callsigns</h2>
          <ul id="allCallsigns" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
  async function safeFetch(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const text = await res.text();
    return text ? JSON.parse(text) : [];
  } catch (e) {
    console.error(`Fetch failed for ${url}:`, e);
    return [];
  }
}
    async function loadDashboard() {
      const callsigns = await fetch('/api/callsigns.php').then(r => r.json());
	  const transcripts = await safeFetch('/api/transcriptions.php');
      const sysStats = await fetch('/api/stats.php').then(r => r.json());
	  const repeaterStats = await fetch('/api/repeaterstats.php').then(r => r.json());
      const temps = await fetch('/api/temperatures.php').then(r => r.json());
	  
	  const intake_temps = await fetch('/api/intake_temperature.php').then(r => r.json());
	  const internal_temps = await fetch('/api/internal_temperature.php').then(r => r.json());
	  const amplifier_temps = await fetch('/api/amplifier_temperature.php').then(r => r.json());
	  const radio_temps = await fetch('/api/radio_temperature.php').then(r => r.json());

      const ignored = ['KK7NQN', 'KK7N'];
      const filteredCallsigns = callsigns.filter(c => !ignored.includes(c.callsign));

      const top10 = filteredCallsigns.sort((a, b) => b.seen_count - a.seen_count).slice(0, 10);
      const callBody = document.getElementById('callsignTableBody');
      top10.forEach(row => {
  callBody.innerHTML += `
    <tr>
      <td><a href="callsign.html?cs=${row.callsign}" class="text-decoration-none text-primary">${row.callsign}</a></td>
      <td>${row.seen_count}</td>
      <td>${row.last_seen}</td>
    </tr>`;
});

const allList = document.getElementById('allCallsigns');
const searchInput = document.getElementById('callsignSearch');

function renderCallsigns(filter = '') {
  allList.innerHTML = '';
  filteredCallsigns
    .filter(row => row.callsign.toLowerCase().includes(filter.toLowerCase()))
    .forEach(row => {
      allList.innerHTML += `
        <li class="list-group-item bg-transparent">
          <a href="callsign.html?cs=${row.callsign}" class="text-white text-decoration-none">${row.callsign}</a>
        </li>`;
    });
}

searchInput.addEventListener('input', () => {
  renderCallsigns(searchInput.value);
});

// Initial render
renderCallsigns();




      const ctxSys = document.getElementById('systemStatsChart').getContext('2d');
      new Chart(ctxSys, {
        type: 'line',
        data: {
          labels: sysStats.map(s => s.timestamp),
          datasets: [
            { label: 'CPU %', data: sysStats.map(s => s.cpu_usage), borderWidth: 1 },
            { label: 'Mem %', data: sysStats.map(s => s.memory_usage), borderWidth: 1 },
            { label: 'CPU °C', data: sysStats.map(s => s.cpu_temp), borderWidth: 1 }
          ]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
	  
	  const ctxSys2 = document.getElementById('repeaterStatsChart').getContext('2d');
      new Chart(ctxSys2, {
        type: 'line',
        data: {
          labels: repeaterStats.map(s => s.timestamp),
          datasets: [
            { label: 'CPU %', data: repeaterStats.map(s => s.cpu_usage), borderWidth: 1 },
            { label: 'Mem %', data: repeaterStats.map(s => s.memory_usage), borderWidth: 1 },
            { label: 'CPU °C', data: repeaterStats.map(s => s.cpu_temp), borderWidth: 1 }
          ]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
	  
	  const ctxSys0 = document.getElementById('tempsChart').getContext('2d');
      new Chart(ctxSys0, {
        type: 'line',
        data: {
          labels: intake_temps.map(s => s.timestamp),
          datasets: [
            { label: 'Amplifier Temp °F', data: intake_temps.map(s => s.temperature_f), borderWidth: 1 },
            { label: 'Internal Air Temp °F', data: internal_temps.map(s => s.temperature_f), borderWidth: 1 },
			{ label: 'Radio Temp °F', data: radio_temps.map(s => s.temperature_f), borderWidth: 1 },
            { label: 'Intake Air Temp °F', data: amplifier_temps.map(s => s.temperature_f), borderWidth: 1 }
          ]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
	  
      const sensorLabels = {
        '28-510500879011': 'Intake Air Temp',
        '28-4f10d446d493': 'Internal Case Temp',
        '28-2531d446d51e': 'Amplifier Temp',
        '28-73e8d4464f3e': 'TX Radio Temp'
      };

      const transcriptBody = document.getElementById('transcriptTableBody');
      transcripts.forEach(row => {
        transcriptBody.innerHTML += `<tr><td>${row.timestamp}</td><td>${row.callsign}</td><td>${row.transcription}</td></tr>`;
      });
    }

    loadDashboard();
  </script>
</body>
<footer class="text-center mt-5 py-3 border-top" style="color:#8b949e;">
  <p>
    🛰️ This project is licensed under the 
    <a href="license.html" class="text-decoration-none" style="color:#58a6ff;">GNU GPL v3.0</a>.<br />
    All data is open-access, bot-friendly, and free for public use. Use it. Build with it. Improve ham radio.
  </p>
</footer>

</html>
